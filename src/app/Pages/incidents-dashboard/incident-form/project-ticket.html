<div class="p-6 bg-white rounded-lg w-full mx-auto" style="padding: 1rem 4rem;">
  <h2 class="text-xl font-bold text-gray-800 mb-2">Create New Incident</h2>
  <p class="text-sm text-gray-500 mb-6">Fill out the form to create a new incident.</p>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-5">
    <!-- Title -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Short Description *</label>
      <input type="text" formControlName="title" placeholder="Enter incident title"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
        [class.border-red-500]="form.get('title')?.invalid && form.get('title')?.touched">
      <p *ngIf="form.get('title')?.invalid && form.get('title')?.touched" class="text-red-500 text-xs mt-1">
        Short Description is required.
      </p>
    </div>

    <!-- Description -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
      <textarea formControlName="description" placeholder="Describe the incident"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 h-20 resize-none"
        [class.border-red-500]="form.get('description')?.invalid && form.get('description')?.touched">
      </textarea>
      <p *ngIf="form.get('description')?.invalid && form.get('description')?.touched" class="text-red-500 text-xs mt-1">
        Description is required.
      </p>
    </div>

    <!-- Project Select -->
    <div class="relative">
      <label class="block text-sm font-medium text-gray-700 mb-1">Project *</label>
      <select formControlName="projectId"
        class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white"
        [class.border-red-500]="form.get('projectId')?.invalid && form.get('projectId')?.touched">
        <option value="">Select Project</option>
        <option *ngFor="let project of projectNames" [value]="project.id">
          {{ project.name }}
        </option>
      </select>
      <mat-icon class="absolute right-3 top-9 text-gray-500 pointer-events-none">arrow_drop_down</mat-icon>
      <p *ngIf="form.get('projectId')?.invalid && form.get('projectId')?.touched" class="text-red-500 text-xs mt-1">
        Please select a project.
      </p>
      <p *ngIf="projectsLoading" class="text-xs text-blue-600 mt-1">Loading projects...</p>
    </div>

    <!-- category -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="relative">
        <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
        <select formControlName="category"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white"
          [class.border-red-500]="form.get('priority')?.invalid && form.get('priority')?.touched">
          <div class="" *ngFor="let category of getCategory">
            <option [value]="category.id">{{category.name}}</option>
          </div>

        </select>
        <mat-icon class="absolute right-3 top-9 text-gray-500 pointer-events-none">arrow_drop_down</mat-icon>
      </div>

      <!-- sub category -->
      <!-- sub category -->
      <div class="relative">
        <label class="block text-sm font-medium text-gray-700 mb-1">Sub Category *</label>
        <select formControlName="subCategory"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white"
          [class.border-red-500]="form.get('subCategory')?.invalid && form.get('subCategory')?.touched">
          <option *ngFor="let subcategory of getSubCategory" [value]="subcategory.id">
            {{ subcategory.name }}
          </option>
        </select>
        <mat-icon class="absolute right-3 top-9 text-gray-500 pointer-events-none">arrow_drop_down</mat-icon>
        <!-- See more option -->
        <button *ngIf="hasMoreSubCategories" type="button" (click)="loadMoreSubCategories()"
          class="text-blue-600 text-sm mt-1 underline">
          See more...
        </button>
      </div>

    </div>

    <!-- Impact & Urgency -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Impact -->
      <div class="relative">
        <label class="block text-sm font-medium text-gray-700 mb-1">Impact *</label>
        <select formControlName="impact"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white"
          [class.border-red-500]="form.get('impact')?.invalid && form.get('impact')?.touched">
          <option value="LOW">LOW</option>
          <option value="MEDIUM">MEDIUM</option>
          <option value="HIGH">HIGH</option>
        </select>
        <mat-icon class="absolute right-3 top-9 text-gray-500 pointer-events-none">arrow_drop_down</mat-icon>
      </div>

      <!-- Urgency -->
      <div class="relative">
        <label class="block text-sm font-medium text-gray-700 mb-1">Urgency *</label>
        <select formControlName="urgency"
          class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white"
          [class.border-red-500]="form.get('urgency')?.invalid && form.get('urgency')?.touched">
          <option value="LOW">LOW</option>
          <option value="MEDIUM">MEDIUM</option>
          <option value="HIGH">HIGH</option>
        </select>
        <mat-icon class="absolute right-3 top-9 text-gray-500 pointer-events-none">arrow_drop_down</mat-icon>
      </div>
    </div>
    <!-- Buttons -->
    <div class="flex justify-end gap-3 pt-4">
      <button type="button" (click)="onCancel()"
        class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 flex items-center gap-1"
        [disabled]="submitting">
        <mat-icon>cancel</mat-icon> Cancel
      </button>

      <button type="submit" [disabled]="form.invalid || submitting || projectsLoading"
        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 relative">
        <mat-icon *ngIf="!submitting">add</mat-icon>
        <span *ngIf="submitting" class="flex items-center">
          <svg class="animate-spin h-4 w-4 mr-1" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" />
            <path fill="currentColor" d="M4 12a8 8 0 018-8v8z" />
          </svg>
          Creating...
        </span>
        <span *ngIf="!submitting">Create</span>
      </button>
    </div>
  </form>
</div>