<div class="dashboard-wrapper" [class.panel-open]="panelOpen">
  <div class="dashboard-content">
  <div
  class="flex flex-col sm:flex-row justify-between items-start sm:items-center p-7 text-white shadow-md bg-gradient-to-r from-red-500 to-red-700"
  style="padding: 2rem 5rem;">
  <!-- Left Section -->
  <div class="space-x-4 sm:mb-0 flex items-center">
    <div class="cursor-pointer hoverBackButton" (click)="backToProj()">
      <mat-icon mat-icon-button>keyboard_arrow_left</mat-icon>
    </div>
    <div class=""><p class="text-2xl font-bold leading-tight">{{  project?.name }}</p>
    <h1 class="text-white/90 text-sm mt-1">{{ project?.description }}</h1>
  </div>
    
  </div>

  <div class="flex gap-4">
    <button (click)="openCreateIncidentDialog()" class="button-name" role="button"><mat-icon>add</mat-icon>Create
      Incident</button>
  </div>
</div>
<div class="space-y-6 bg-gray-50 min-h-screen" style="padding: 2em 5em;">
  <!-- Top Stat Cards -->
  <div class="grid gap-4"  [ngClass]="{
       'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5': !panelOpen,
       'grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4': panelOpen
     }">
    <!-- Incidents -->
    <div class="flex items-center justify-between bg-white rounded-2xl shadow p-4">
      <div class="flex items-center w-full space-x-3">
        <mat-icon class="mat-icon report_problem text-red-500">report_problem</mat-icon>
        <div class="flex justify-between items-center" style="width: 80%;">
          <p class="text-sm text-gray-500">Incidents</p>
          <p class="text-lg font-semibold">{{ totalElements }}</p>
        </div>
      </div>
    </div>

    <!-- Teams -->
    <div class="flex items-center justify-between bg-white rounded-2xl cursor-pointer shadow p-4 hoverCard" (click)="openGroups()">
      <div class="flex items-center w-full space-x-3">
        <mat-icon class="text-orange-500 mat-icon groups">groups</mat-icon>
        <div class="flex justify-between items-center" style="width: 80%;">
          <p class="text-sm text-gray-500">Teams</p>
        </div>
      </div>
    </div>

    <!-- Contract -->
    <div class="flex items-center justify-between bg-white rounded-2xl shadow p-4">
      <div class="flex items-center w-full space-x-3">
        <mat-icon class="text-yellow-500 mat-icon assignment">assignment</mat-icon>
        <div class="flex justify-between items-center" style="width: 80%;">
          <p class="text-sm text-gray-500 ">Contract</p>
          <p class="text-lg font-semibold">0</p>
        </div>
      </div>
    </div>

    <!-- Analytics -->
    <div class="flex items-center justify-between bg-white rounded-2xl shadow p-4 opacity-50">
      <div class="flex items-center space-x-3">
        <mat-icon class="text-gray-400 mat-icon analytics">analytics</mat-icon>
        <div class="flex justify-between items-center" style="width: 80%;">
          <p class="text-sm text-gray-500">Analytics</p>
        </div>
      </div>
    </div>
    <!-- client user -->
    <div class="flex items-center justify-between bg-white cursor-pointer rounded-2xl shadow p-4 hoverCard" (click)="openClient()">
      <div class="flex items-center w-full space-x-3">
        <mat-icon class="text-gray-400 mat-icon groups">groups</mat-icon>
        <div class="flex justify-between items-center" style="width: 80%;">
          <p class="text-sm text-gray-500">Client Users</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Title -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between">
    <div>
      <h2 class="text-xl font-semibold text-gray-800">Incidents</h2>
      <p class="text-sm text-gray-500">Critical and high priority incidents requiring immediate attention</p>
    </div>

    <!-- Filters -->
    <div class="flex items-center space-x-3 mt-3 sm:mt-0">
  <span class="text-sm text-gray-500 font-medium">View:</span>

  <!-- ALL -->
  <button 
    (click)="setPriorityFilter('ALL')"
    class="px-3 py-1 text-sm font-medium rounded-full transition-colors"
    [class.bg-blue-100]="selectedPriority === 'ALL'"
    [class.text-blue-600]="selectedPriority === 'ALL'"
    [class.text-gray-600]="selectedPriority !== 'ALL'"
    [class.hover:bg-gray-100]="selectedPriority !== 'ALL'">
    ALL
  </button>

  <!-- LOW -->
  <button 
    (click)="setPriorityFilter('LOW')"
    class="px-3 py-1 text-sm font-medium rounded-full transition-colors"
    [class.bg-blue-100]="selectedPriority === 'LOW'"
    [class.text-blue-600]="selectedPriority === 'LOW'"
    [class.text-gray-600]="selectedPriority !== 'LOW'"
    [class.hover:bg-gray-100]="selectedPriority !== 'LOW'">
    LOW
  </button>

  <!-- MEDIUM -->
  <button 
    (click)="setPriorityFilter('MEDIUM')"
    class="px-3 py-1 text-sm font-medium rounded-full transition-colors"
    [class.bg-blue-100]="selectedPriority === 'MEDIUM'"
    [class.text-blue-600]="selectedPriority === 'MEDIUM'"
    [class.text-gray-600]="selectedPriority !== 'MEDIUM'"
    [class.hover:bg-gray-100]="selectedPriority !== 'MEDIUM'">
    MEDIUM
  </button>

  <!-- HIGH -->
  <button 
    (click)="setPriorityFilter('HIGH')"
    class="px-3 py-1 text-sm font-medium rounded-full transition-colors"
    [class.bg-blue-100]="selectedPriority === 'HIGH'"
    [class.text-blue-600]="selectedPriority === 'HIGH'"
    [class.text-gray-600]="selectedPriority !== 'HIGH'"
    [class.hover:bg-gray-100]="selectedPriority !== 'HIGH'">
    HIGH
  </button>
</div>
  </div>

  <!-- Table -->
  <div *ngIf="incidentsLoading" class="text-center py-8 text-gray-500">
  Loading incidents...
</div>

<!-- Error State -->
<div *ngIf="incidentsError && !incidentsLoading" class="text-center py-8 text-red-500">
  {{ incidentsError }}
  <button (click)="loadIncidents()" class="ml-2 text-blue-600 underline">Retry</button>
</div>

<!-- Table (only show if not loading/error) -->
<div *ngIf="!incidentsLoading && !incidentsError" class="bg-white shadow rounded-2xl overflow-hidden">
  <table class="w-full text-left border-collapse">
    <thead class="bg-gray-100 text-sm text-gray-600">
      <tr>
        <th class="px-4 py-3"><input type="checkbox" /></th>
        <th class="px-4 py-3">Incident ID</th>
        <th class="px-4 py-3">Title</th>
        <th class="px-4 py-3">Priority</th>
        <th class="px-4 py-3">Status</th>
        <th class="px-4 py-3">Assigned To</th>
        <th class="px-4 py-3">Created</th>
        <th class="px-4 py-3">Due Date</th>
      </tr>
    </thead>
    <tbody class="divide-y text-sm" *ngIf="incidents.length > 0; else noIncidents">
      <tr *ngFor="let incident of incidents let i = index" class="hover:bg-gray-50">
        <td class="px-4 py-3"><input type="checkbox" /></td>
        <td class="px-4 py-3 font-mono text-gray-700">{{ i + 1 }}</td>
        <td class="px-4 py-3 font-medium text-gray-800 cursor-pointer hoverTitle" (click)="openIncidentDetails(incident)"><a>{{ incident.title }}</a></td>
        <td class="px-4 py-3">
          <span [ngClass]="priorityClass(incident.priority)" class="px-2 py-1 text-xs font-medium rounded-full">
            {{ incident.priority }}
          </span>
        </td>
        <td class="px-4 py-3">
          <span [ngClass]="statusClass(incident.status)" class="px-2 py-1 text-xs font-medium rounded-full">
            {{ incident.status }}
          </span>
        </td>
        <td class="px-4 py-3">
          <span class="text-sm text-gray-600">{{ incident.assignedToName }}</span>
        </td>
        <td class="px-4 py-3 text-gray-600">{{ incident.createdByName }}</td>
        <td class="px-4 py-3 font-medium" [ngClass]="incident.dueOverdue ? 'text-red-500' : 'text-green-500'">
          {{ incident.dueDate }}
          <span *ngIf="incident.dueOverdue" class="text-xs">(Overdue)</span>
          <span *ngIf="!incident.dueOverdue && incident.completed" class="text-xs">(Completed)</span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Empty State -->
  <ng-template #noIncidents>
    <tbody>
      <tr>
        <td colspan="8" class="text-center py-8 text-gray-500">No incidents found.</td>
      </tr>
    </tbody>
  </ng-template>

  <!-- Pagination (Dynamic) -->
  <div class="flex items-center justify-between p-4 border-t text-sm text-gray-600">
    <p>Showing {{ incidents.length }} of {{ totalElements }} incidents</p>
    <div class="flex items-center space-x-2">
      <button 
        (click)="onPageChange(pageNumber - 1)" 
        [disabled]="pageNumber === 0"
        class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
        Previous
      </button>
      <button 
        *ngFor="let p of [].constructor(totalPages); let i = index"
        (click)="onPageChange(i)"
        [class.bg-blue-100]="i === pageNumber"
        [class.text-blue-600]="i === pageNumber"
        class="px-3 py-1 border rounded hover:bg-gray-100">
        {{ i + 1 }}
      </button>
      <button 
        (click)="onPageChange(pageNumber + 1)" 
        [disabled]="pageNumber >= totalPages - 1"
        class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
        Next
      </button>
    </div>
  </div>
</div>
</div>
</div>

<app-incident-detail-panel-component
    class="detail-panel"
    [class.open]="panelOpen"
    *ngIf="selectedIncident"
    [incident]="selectedIncident!"
    [MembersList]="projectAssignedMembers!"
    (closed)="closeIncidentDetails()">
  </app-incident-detail-panel-component>
</div>
