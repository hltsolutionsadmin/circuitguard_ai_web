<div class="bg-gray-100 font-sans flex h-screen overflow-hidden">
  <!-- Sidebar -->
  <div [class.w-64]="!isMobile || sidenavOpen" [class.w-0]="isMobile && !sidenavOpen" [class.absolute]="isMobile"
    [class.left-0]="isMobile" [class.h-[calc(100vh-3rem)]]="isMobile"
    class="flex-shrink-0 bg-gray-800 shadow-2xl z-20 transition-all duration-300 ease-in-out lg:w-64 lg:static"
    [class.transform]="isMobile" [class.-translate-x-full]="isMobile && !sidenavOpen"
    [class.translate-x-0]="isMobile && sidenavOpen">
    <div class="flex flex-col h-full overflow-y-auto">
      <form action="" [formGroup]="projectForm">
        <div class="relative p-4">
          <select formControlName="projectId"
            class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none bg-white"
            style="background-color: var(--color-gray-800); color: white;">
            <option value="" disabled>Select Project</option>
            <option *ngFor="let project of projectNames" [value]="project.id">
              {{ project.name }}
            </option>
          </select>
          <mat-icon class="absolute right-3 top-9 text-gray-500 pointer-events-none"
            style="top: 1em; margin-right: .5em; color: white;">arrow_drop_down</mat-icon>
          <p *ngIf="projectsLoading" class="text-xs text-blue-600 mt-1">Loading projects...</p>
        </div>
      </form>
      <!-- Search inside sidebar -->


      <!-- Navigation items -->
      <div class="flex-1 overflow-y-auto pt-0">
        <ng-container *ngFor="let item of navItems">
          <ng-container *ngIf="shouldShowNavItem(item)">
            <!-- Top-level item -->
            <div class="cursor-pointer text-sm transition-colors duration-150" style="background-color: 
#3f5060; border-bottom: 1px solid #333;" [class.bg-blue-900]="isActive(item)" [class.text-white]="isActive(item)"
              [class.text-gray-200]="!isActive(item)" [class.hover:bg-gray-700]="!isActive(item)"
              [class.border-l-4]="isActive(item)" [class.border-blue-400]="isActive(item)">
              <div class="px-4 py-2 font-medium flex justify-between items-center" (click)="toggleSubmenu(item)"
                [routerLink]="item.route">
                {{ item.label }}
                <mat-icon *ngIf="item.children" class="text-gray-400 text-sm">
                  {{ item.active ? 'expand_less' : 'expand_more' }}
                </mat-icon>
              </div>
            </div>

            <!-- Submenu -->
            <div *ngIf="item.active && item.children" class="bg-gray-900 text-gray-300">
              <div *ngFor="let sub of item.children"
                class="hover:bg-gray-700 cursor-pointer text-sm pl-8 py-1.5 transition-colors duration-150"
                [class.bg-gray-700]="isActive(sub)" [class.text-white]="isActive(sub)" [routerLink]="sub.route">
                {{ sub.label }}
              </div>
            </div>
          </ng-container>

        </ng-container>


      </div>
    </div>
  </div>

  <!-- Main content area -->
  <div class="flex flex-col flex-1">
    <!-- Top navbar -->
    <nav
      class="bg-white p-2 flex items-center justify-between z-30 shadow-sm border-b border-gray-200 h-12 flex-shrink-0"
      style="background-color: var(--color-gray-800); padding: 2rem; z-index: 1000;">
      <div class="flex items-center space-x-2">
        <!-- Menu toggle: always visible now -->
        <button class="p-1 searchIcon hidden rounded hover:bg-gray-100">
          <mat-icon class="text-gray-600">menu</mat-icon>
        </button>

        <span class="text-lg font-normal text-gray-700 hidden sm:inline" style="color: white;">Circuit Guard.ai</span>
      </div>

      <div class="flex items-center space-x-3">
        <div class="hidden sm:block">
          <input placeholder="Search"
            class="border border-gray-300 rounded-sm px-2 py-1.5 text-sm w-48 focus:outline-none focus:ring-1 focus:ring-blue-500"
            type="text" style="color: white;" />
        </div>

        <div class="w-px h-6 bg-gray-300"></div>

        <!-- User dropdown -->
        <div class="flex items-center space-x-2 cursor-pointer" [matMenuTriggerFor]="userMenu">
          <span class="text-sm font-medium text-gray-800 hidden sm:block" style="color: white;">{{ user?.fullName || 'User Name'}}</span>
          <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm" *ngIf="user">
            {{ getInitials() }}
          </div>
          <mat-icon class="text-white-600 text-xl" style="color: white;">arrow_drop_down</mat-icon>
        </div>

        <!-- Material Menu -->
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Logout</span>
          </button>
        </mat-menu>
      </div>
    </nav>

    <!-- Main scrollable content -->
    <main class="flex-1 overflow-y-auto h-[calc(100vh-3rem)]">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>